#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ —Å –¥–æ—Å—Ç—É–ø–æ–º –∏–∑–≤–Ω–µ

echo "üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
echo "============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
if [ ! -f ".streamlit/secrets.toml" ]; then
    echo "‚ùå –§–∞–π–ª .streamlit/secrets.toml –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üìù –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å API –∫–ª—é—á–∞–º–∏:"
    echo "   cp secrets.toml.template .streamlit/secrets.toml"
    echo "   # –ó–∞—Ç–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ Bybit API –∫–ª—é—á–∏"
    exit 1
fi

# –í—ã–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥ —Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:"
echo "1) ngrok (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –Ω–æ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π)"
echo "2) localtunnel (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –Ω–æ URL –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)"
echo "3) –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)"
read -p "–í–∞—à –≤—ã–±–æ—Ä (1-3): " choice

case $choice in
    1)
        echo "üåê –ó–∞–ø—É—Å–∫ —Å ngrok..."
        python3 run_local_with_tunnel.py
        ;;
    2)
        echo "üåê –ó–∞–ø—É—Å–∫ —Å localtunnel..."
        python3 run_local_simple.py
        ;;
    3)
        echo "üì± –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ..."
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞—Ç—å
        if [ -f "app_enhanced_v2.py" ]; then
            APP_FILE="app_enhanced_v2.py"
        elif [ -f "app_enhanced.py" ]; then
            APP_FILE="app_enhanced.py"
        else
            APP_FILE="app.py"
        fi
        
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é $APP_FILE..."
        python3 -m streamlit run $APP_FILE --server.port=8501
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!"
        exit 1
        ;;
esac 